{
  "kind": "build_request",
  "title": "Fix Completion Date auto-population when marking tasks as Completed",
  "projectName": "CSWA Group of Companies",
  "priority": "high",
  "requirements": [
    {
      "id": "REQ-97",
      "text": "Fix the backend Task update logic in backend/main.mo so that when a task's status is changed to 'Completed', the completionDate field is reliably set to the current timestamp (Time.now()) if it is not already set, ensuring the auto-population works correctly and produces valid dates.",
      "target": "backend",
      "source": {
        "messageIds": [
          "user-message"
        ],
        "quotes": [
          "when mark complte but not autoupdating the date or it is invalid date"
        ]
      },
      "acceptanceCriteria": [
        "When a task's status is updated to 'Completed', the completionDate is automatically set to Time.now() if it is currently null or not set",
        "The auto-populated completionDate displays as a valid, readable date in the frontend (not 'Invalid Date')",
        "Existing tasks that already have a completionDate set are not overwritten",
        "The fix works for all task update paths: single task edit (TaskFormDialog), quick status change (TaskQuickStatus), and bulk edit (TaskBulkEditDialog)"
      ]
    },
    {
      "id": "REQ-98",
      "text": "Verify that the frontend task update mutations in frontend/src/hooks/tasks.ts (useUpdateTask, useBulkUpdateTasks) and all task update UI components (TaskFormDialog, TaskQuickStatus, TaskBulkEditDialog) are sending complete task payloads to the backend, including the current status value, so the backend can correctly detect status transitions to 'Completed'.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "user-message"
        ],
        "quotes": [
          "when mark complte but not autoupdating the date or it is invalid date"
        ]
      },
      "acceptanceCriteria": [
        "All task update API calls include the status field in the request payload",
        "The backend receives accurate status values to determine when a transition to 'Completed' occurs",
        "No frontend validation or encoding errors prevent the status from being sent correctly"
      ]
    },
    {
      "id": "REQ-99",
      "text": "Add defensive date validation in the frontend task display utilities (frontend/src/utils/taskDisplay.ts) to ensure completionDate timestamps are properly converted to readable date strings, handling edge cases like null values, invalid timestamps, or timestamps outside valid Date ranges.",
      "target": "frontend",
      "source": {
        "messageIds": [
          "user-message"
        ],
        "quotes": [
          "it is invalid date"
        ]
      },
      "acceptanceCriteria": [
        "The formatDate utility handles null/undefined timestamps gracefully (displays 'â€”' or empty)",
        "Invalid or malformed timestamps do not cause 'Invalid Date' to appear in the UI",
        "Completion Date column in the Tasks table displays valid dates for all completed tasks",
        "Task detail views (TaskDetailsPanel, ClientDetailPage task lists) show valid completion dates"
      ]
    }
  ],
  "constraints": [
    "Do not change the backend Task data model schema",
    "Preserve backward compatibility with existing stored completionDate values",
    "Keep all user-facing text in English"
  ],
  "nonGoals": [
    "Changing the status options or status validation logic",
    "Modifying the Assignment Date auto-population logic",
    "Adding new task fields or changing existing field types"
  ],
  "imageRequirements": {
    "required": [],
    "edits": []
  }
}